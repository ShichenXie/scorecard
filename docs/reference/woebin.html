<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>WOE Binning — woebin • scorecard</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="WOE Binning — woebin" />
<meta property="og:description" content="woebin generates optimal binning for numerical, factor and categorical variables using methods including tree-like segmentation or chi-square merge. woebin can also customizing breakpoints if the breaks_list was provided. The default woe is defined as ln(Pos_i/Neg_i). If you prefer ln(Neg_i/Pos_i), please set the argument positive as negative value, such as '0' or 'good'. If there is a zero frequency class when calculating woe, the zero will replaced by 0.99 to make the woe calculable." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scorecard</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/demo.html">Developing a Credit Scorcard</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://shichen.name/slide/20171115scorecard/">
    <span class="fas fa-file-powerpoint-o fa-lg"></span>
     
    slides
  </a>
</li>
<li>
  <a href="http://shichen.name/donate/">
    <span class="fas fa-money fa-lg"></span>
     
    donate
  </a>
</li>
<li>
  <a href="https://github.com/ShichenXie/scorecard">
    <span class="fas fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>WOE Binning</h1>
    <small class="dont-index">Source: <a href='https://github.com/ShichenXie/scorecard/blob/master/R/woebin.R'><code>R/woebin.R</code></a></small>
    <div class="hidden name"><code>woebin.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>woebin</code> generates optimal binning for numerical, factor and categorical variables using methods including tree-like segmentation or chi-square merge. <code>woebin</code> can also customizing breakpoints if the <code>breaks_list</code> was provided. The default <code>woe</code> is defined as ln(Pos_i/Neg_i). If you prefer ln(Neg_i/Pos_i), please set the argument <code>positive</code> as negative value, such as '0' or 'good'. If there is a zero frequency class when calculating woe, the zero will replaced by 0.99 to make the woe calculable.</p>
    </div>

    <pre class="usage"><span class='fu'>woebin</span><span class='op'>(</span><span class='va'>dt</span>, <span class='va'>y</span>, x <span class='op'>=</span> <span class='cn'>NULL</span>, var_skip <span class='op'>=</span> <span class='cn'>NULL</span>, breaks_list <span class='op'>=</span> <span class='cn'>NULL</span>,
  special_values <span class='op'>=</span> <span class='cn'>NULL</span>, stop_limit <span class='op'>=</span> <span class='fl'>0.1</span>, count_distr_limit <span class='op'>=</span> <span class='fl'>0.05</span>,
  bin_num_limit <span class='op'>=</span> <span class='fl'>8</span>, positive <span class='op'>=</span> <span class='st'>"bad|1"</span>, no_cores <span class='op'>=</span> <span class='cn'>NULL</span>,
  print_step <span class='op'>=</span> <span class='fl'>0L</span>, method <span class='op'>=</span> <span class='st'>"tree"</span>, save_breaks_list <span class='op'>=</span> <span class='cn'>NULL</span>,
  ignore_const_cols <span class='op'>=</span> <span class='cn'>TRUE</span>, ignore_datetime_cols <span class='op'>=</span> <span class='cn'>TRUE</span>,
  check_cate_num <span class='op'>=</span> <span class='cn'>TRUE</span>, replace_blank_inf <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dt</th>
      <td><p>A data frame with both x (predictor/feature) and y (response/label) variables.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Name of y variable.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>Name of x variables. Defaults to NULL. If x is NULL, then all columns except y and var_skip are counted as x variables.</p></td>
    </tr>
    <tr>
      <th>var_skip</th>
      <td><p>Name of variables that will skip for binning. Defaults to NULL.</p></td>
    </tr>
    <tr>
      <th>breaks_list</th>
      <td><p>List of break points, Defaults to NULL. If it is not NULL, variable binning will based on the provided breaks.</p></td>
    </tr>
    <tr>
      <th>special_values</th>
      <td><p>the values specified in special_values will be in separate bins. Defaults to NULL.</p></td>
    </tr>
    <tr>
      <th>stop_limit</th>
      <td><p>Stop binning segmentation when information value gain ratio less than the 'stop_limit' if using tree method; or stop binning merge when the chi-square of each neighbor bins are larger than the threshold under significance level of 'stop_limit' and freedom degree of 1 if using chimerge method. Accepted range: 0-0.5; Defaults to 0.1. If it is 'N', each x value is a bin.</p></td>
    </tr>
    <tr>
      <th>count_distr_limit</th>
      <td><p>The minimum count distribution percentage. Accepted range: 0.01-0.2; Defaults to 0.05.</p></td>
    </tr>
    <tr>
      <th>bin_num_limit</th>
      <td><p>Integer. The maximum number of binning. Defaults to 8.</p></td>
    </tr>
    <tr>
      <th>positive</th>
      <td><p>Value of positive class, defaults to "bad|1".</p></td>
    </tr>
    <tr>
      <th>no_cores</th>
      <td><p>Number of CPU cores for parallel computation. Defaults to 90 percent of total cpu cores.</p></td>
    </tr>
    <tr>
      <th>print_step</th>
      <td><p>A non-negative integer. Defaults to 1. If print_step&gt;0, print variable names by each print_step-th iteration. If print_step=0 or no_cores&gt;1, no message is print.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Four methods are provided, "tree" and "chimerge" for optimal binning that support both numerical and categorical variables, and 'width' and 'freq' for equal binning that support numerical variables only. Defaults to "tree".</p></td>
    </tr>
    <tr>
      <th>save_breaks_list</th>
      <td><p>A string. The file name to save breaks_list. Defaults to None.</p></td>
    </tr>
    <tr>
      <th>ignore_const_cols</th>
      <td><p>Logical. Ignore constant columns. Defaults to TRUE.</p></td>
    </tr>
    <tr>
      <th>ignore_datetime_cols</th>
      <td><p>Logical. Ignore datetime columns. Defaults to TRUE.</p></td>
    </tr>
    <tr>
      <th>check_cate_num</th>
      <td><p>Logical. Check whether the number of unique values in categorical columns larger than 50. It might make the binning process slow if there are too many unique categories. Defaults to TRUE.</p></td>
    </tr>
    <tr>
      <th>replace_blank_inf</th>
      <td><p>Logical. Replace blank values with NA and infinite with -1. Defaults to TRUE.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional parameters.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of data frames include binning information for each x variables.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='woebin_ply.html'>woebin_ply</a></code>, <code><a href='woebin_plot.html'>woebin_plot</a></code>, <code><a href='woebin_adj.html'>woebin_adj</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># load germancredit data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>germancredit</span><span class='op'>)</span>

<span class='co'># Example I</span>
<span class='co'># binning of two variables in germancredit dataset</span>
<span class='co'># using tree method</span>
<span class='va'>bins2_tree</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y<span class='op'>=</span><span class='st'>"creditability"</span>,
   x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"credit.amount"</span>,<span class='st'>"housing"</span><span class='op'>)</span>, method<span class='op'>=</span><span class='st'>"tree"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [INFO] creating woe binning ... </div><div class='input'><span class='va'>bins2_tree</span>
</div><div class='output co'>#&gt; $credit.amount
#&gt;         variable         bin count count_distr neg pos   posprob         woe
#&gt; 1: credit.amount [-Inf,1400)   267       0.267 185  82 0.3071161  0.03366128
#&gt; 2: credit.amount [1400,1800)   105       0.105  87  18 0.1714286 -0.72823850
#&gt; 3: credit.amount [1800,4000)   382       0.382 287  95 0.2486911 -0.25830746
#&gt; 4: credit.amount [4000,9200)   196       0.196 120  76 0.3877551  0.39053946
#&gt; 5: credit.amount [9200, Inf)    50       0.050  21  29 0.5800000  1.17007125
#&gt;          bin_iv  total_iv breaks is_special_values
#&gt; 1: 0.0003045545 0.1812204   1400             FALSE
#&gt; 2: 0.0468153322 0.1812204   1800             FALSE
#&gt; 3: 0.0241086966 0.1812204   4000             FALSE
#&gt; 4: 0.0319870413 0.1812204   9200             FALSE
#&gt; 5: 0.0780047502 0.1812204    Inf             FALSE
#&gt; 
#&gt; $housing
#&gt;    variable      bin count count_distr neg pos   posprob        woe     bin_iv
#&gt; 1:  housing     rent   179       0.179 109  70 0.3910615  0.4044452 0.03139265
#&gt; 2:  housing      own   713       0.713 527 186 0.2608696 -0.1941560 0.02579501
#&gt; 3:  housing for free   108       0.108  64  44 0.4074074  0.4726044 0.02610577
#&gt;      total_iv   breaks is_special_values
#&gt; 1: 0.08329343     rent             FALSE
#&gt; 2: 0.08329343      own             FALSE
#&gt; 3: 0.08329343 for free             FALSE
#&gt; </div><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># using chimerge method</span>
<span class='va'>bins2_chi</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y<span class='op'>=</span><span class='st'>"creditability"</span>,
   x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"credit.amount"</span>,<span class='st'>"housing"</span><span class='op'>)</span>, method<span class='op'>=</span><span class='st'>"chimerge"</span><span class='op'>)</span>

<span class='co'># binning in equal freq/width # only supports numerical variables</span>
<span class='va'>numeric_cols</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"duration.in.month"</span>, <span class='st'>"credit.amount"</span>,
  <span class='st'>"installment.rate.in.percentage.of.disposable.income"</span>, <span class='st'>"present.residence.since"</span>,
  <span class='st'>"age.in.years"</span>, <span class='st'>"number.of.existing.credits.at.this.bank"</span>,
  <span class='st'>"number.of.people.being.liable.to.provide.maintenance.for"</span><span class='op'>)</span>
<span class='va'>bins_freq</span>  <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y<span class='op'>=</span><span class='st'>"creditability"</span>, x<span class='op'>=</span><span class='va'>numeric_cols</span>, method<span class='op'>=</span><span class='st'>"freq"</span><span class='op'>)</span>
<span class='va'>bins_width</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y<span class='op'>=</span><span class='st'>"creditability"</span>, x<span class='op'>=</span><span class='va'>numeric_cols</span>, method<span class='op'>=</span><span class='st'>"width"</span><span class='op'>)</span>

<span class='co'># y can be NULL if no label column in dataset</span>
<span class='va'>bins_freq_noy</span>  <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y<span class='op'>=</span><span class='cn'>NULL</span>, x<span class='op'>=</span><span class='va'>numeric_cols</span><span class='op'>)</span>

<span class='co'># Example II</span>
<span class='co'># setting of stop_limit</span>
<span class='co'># stop_limit = 0.1 (by default)</span>
<span class='va'>bins_x1</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y <span class='op'>=</span> <span class='st'>'creditability'</span>, x <span class='op'>=</span> <span class='st'>'foreign.worker'</span>, stop_limit <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>
<span class='co'># stop_limit = 'N', each x value is a bin</span>
<span class='va'>bins_x1_N</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y <span class='op'>=</span> <span class='st'>'creditability'</span>, x <span class='op'>=</span> <span class='st'>'foreign.worker'</span>, stop_limit <span class='op'>=</span> <span class='st'>'N'</span><span class='op'>)</span>

<span class='co'># Example III</span>
<span class='co'># binning of the germancredit dataset</span>
<span class='va'>bins_germ</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y <span class='op'>=</span> <span class='st'>"creditability"</span><span class='op'>)</span>
<span class='co'># converting bins_germ into a data frame</span>
<span class='co'># bins_germ_df = data.table::rbindlist(bins_germ)</span>

<span class='co'># Example IV</span>
<span class='co'># customizing the breakpoints of binning</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-datatable.com'>data.table</a></span><span class='op'>)</span>
<span class='va'>dat</span> <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html'>rbind</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/setDT.html'>setDT</a></span><span class='op'>(</span><span class='va'>germancredit</span><span class='op'>)</span>,
  <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>creditability<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"good"</span>,<span class='st'>"bad"</span><span class='op'>)</span>,<span class='fl'>10</span>,replace<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>,
  fill<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>breaks_list</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  age.in.years <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>26</span>, <span class='fl'>35</span>, <span class='fl'>37</span>, <span class='st'>"Inf%,%missing"</span><span class='op'>)</span>,
  housing <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"own"</span>, <span class='st'>"for free%,%rent"</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>special_values</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  credit.amount <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2600</span>, <span class='fl'>9960</span>, <span class='st'>"6850%,%missing"</span><span class='op'>)</span>,
  purpose <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"education"</span>, <span class='st'>"others%,%missing"</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>bins_cus_brk</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>dat</span>, y<span class='op'>=</span><span class='st'>"creditability"</span>,
  x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"age.in.years"</span>,<span class='st'>"credit.amount"</span>,<span class='st'>"housing"</span>,<span class='st'>"purpose"</span><span class='op'>)</span>,
  breaks_list<span class='op'>=</span><span class='va'>breaks_list</span>, special_values<span class='op'>=</span><span class='va'>special_values</span><span class='op'>)</span>

<span class='co'># Example V</span>
<span class='co'># save breaks_list as a R file</span>
<span class='va'>bins2</span> <span class='op'>=</span> <span class='fu'>woebin</span><span class='op'>(</span><span class='va'>germancredit</span>, y<span class='op'>=</span><span class='st'>"creditability"</span>,
   x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"credit.amount"</span>,<span class='st'>"housing"</span><span class='op'>)</span>, save_breaks_list<span class='op'>=</span><span class='st'>'breaks_list'</span><span class='op'>)</span>

<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Shichen Xie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


